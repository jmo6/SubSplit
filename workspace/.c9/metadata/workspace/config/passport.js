{"filter":false,"title":"passport.js","tooltip":"/config/passport.js","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":59,"column":2},"action":"insert","lines":["var FacebookStrategy = require('passport-facebook').Strategy;","var User = require('../models/fbUser');","var configAuth= require('./auth');","","module.exports = function(passport) {","\tpassport.serializeUser(function(user, done) {","\t\tconsole.log(\"serializing \" + user.username);","        done(null, user.fbUserSchema.id);","    });","\t/*passport.serializeUser(function(user, done) {","\t\t","        console.log('serializing user: ');","        console.log(user);","        done(null, user.id);","    }); */","","\tpassport.deserializeUser(function(id, done) {","        done(null, { id: User.fbUserSchema.id, token: User.fbUserSchema.token, name: User.fbUserSchema.name, email: User.fbUserSchema.email})","","    });","    ","    /*passport.deserializeUser(function(id, done) {","        User.findById(id, function(err, user) {","            console.log('deserializing user:',user);","            done(err, user);","        });","    });*/","    ","    passport.use(new FacebookStrategy({","        clientID        : configAuth.facebookAuth.clientID,","        clientSecret    : configAuth.facebookAuth.clientSecret,","        callbackURL     : configAuth.facebookAuth.callbackUrl,","        profileFields: ['id', 'displayName', 'photos', 'emails', 'name']","    },","    function(accessToken, refreshToken, profile, done){","\t    \tprocess.nextTick(function(){","\t    \t\tUser.findOne({'id': profile.id}, function(err, user){","\t    \t\t\tif(err)","\t    \t\t\t\treturn done(err);","\t    \t\t\tif(user)","\t    \t\t\t\treturn done(null, user);","\t    \t\t\telse {","\t    \t\t\t\tvar newUser = new User();","\t    \t\t\t\tnewUser.id = profile.id;","\t    \t\t\t\tnewUser.token = accessToken;","\t    \t\t\t\tnewUser.name = profile.name.givenName + ' ' + profile.name.familyName;","\t    \t\t\t\tnewUser.email = profile.emails[0].value;","\t    \t\t\t\t","\t    \t\t\t\tnewUser.save(function(err){","\t    \t\t\t\t\tif(err)","\t    \t\t\t\t\t\tthrow err;","\t    \t\t\t\t\treturn done(null, newUser);","\t    \t\t\t\t})","\t    \t\t\t}","\t    \t\t});","\t    \t});","    }));","    ","","};"],"id":2}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":11,"column":8},"end":{"row":11,"column":8},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":41,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1520835445916,"hash":"b60e64c23e27c12102c7ba6413494b7732527c14"}