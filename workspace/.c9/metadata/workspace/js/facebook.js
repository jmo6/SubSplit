{"filter":false,"title":"facebook.js","tooltip":"/js/facebook.js","undoManager":{"mark":8,"position":8,"stack":[[{"start":{"row":0,"column":0},"end":{"row":57,"column":2},"action":"insert","lines":["var FacebookStrategy = require('passport-facebook').Strategy;","var User = require('../../models/fbUser');","var fbConfig = require('../../models/fb.js');","","module.exports = function(passport) {","","    passport.use('facebook', new FacebookStrategy({","        clientID        : fbConfig.appID,","        clientSecret    : fbConfig.appSecret,","        callbackURL     : fbConfig.callbackUrl","    },","","    // facebook will send back the tokens and profile","    function(access_token, refresh_token, profile, done) {","","    \tconsole.log('profile', profile);","","\t\t// asynchronous","\t\tprocess.nextTick(function() {","","\t\t\t// find the user in the database based on their facebook id","\t        User.findOne({ 'id' : profile.id }, function(err, user) {","","\t        \t// if there is an error, stop everything and return that","\t        \t// ie an error connecting to the database","\t            if (err)","\t                return done(err);","","\t\t\t\t// if the user is found, then log them in","\t            if (user) {","\t                return done(null, user); // user found, return that user","\t            } else {","\t                // if there is no user found with that facebook id, create them","\t                var newUser = new User();","","\t\t\t\t\t// set all of the facebook information in our user model","\t                newUser.id    = profile.id; // set the users facebook id\t                ","\t                newUser.access_token = access_token; // we will save the token that facebook provides to the user\t                ","\t                newUser.firstName  = profile.name.givenName;","\t                newUser.lastName = profile.name.familyName; // look at the passport user profile to see how names are returned","\t                newUser.email = profile.emails[0].value; // facebook can return multiple emails so we'll take the first","","\t\t\t\t\t// save our user to the database","\t                newUser.save(function(err) {","\t                    if (err)","\t                        throw err;","","\t                    // if successful, return the new user","\t                    return done(null, newUser);","\t                });","\t            }","","\t        });","        });","","    }));","","};"],"id":1}],[{"start":{"row":1,"column":20},"end":{"row":1,"column":23},"action":"remove","lines":["../"],"id":2}],[{"start":{"row":2,"column":24},"end":{"row":2,"column":27},"action":"remove","lines":["../"],"id":3}],[{"start":{"row":1,"column":22},"end":{"row":1,"column":23},"action":"remove","lines":["/"],"id":4}],[{"start":{"row":1,"column":21},"end":{"row":1,"column":22},"action":"remove","lines":["."],"id":5}],[{"start":{"row":1,"column":20},"end":{"row":1,"column":21},"action":"remove","lines":["."],"id":6}],[{"start":{"row":2,"column":26},"end":{"row":2,"column":27},"action":"remove","lines":["/"],"id":7}],[{"start":{"row":2,"column":25},"end":{"row":2,"column":26},"action":"remove","lines":["."],"id":8}],[{"start":{"row":2,"column":24},"end":{"row":2,"column":25},"action":"remove","lines":["."],"id":9}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":6,"column":16},"end":{"row":6,"column":16},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":8,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1520290025988,"hash":"98910546adac4085c2d3047b0a93ad6e998b497f"}