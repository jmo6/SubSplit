{"filter":false,"title":"facebook.js","tooltip":"/facebook.js","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":57,"column":2},"action":"insert","lines":["var FacebookStrategy = require('passport-facebook').Strategy;","var User = require('../../models/fbUser');","var fbConfig = require('../../models/fb.js');","","module.exports = function(passport) {","","    passport.use('facebook', new FacebookStrategy({","        clientID        : fbConfig.appID,","        clientSecret    : fbConfig.appSecret,","        callbackURL     : fbConfig.callbackUrl","    },","","    // facebook will send back the tokens and profile","    function(access_token, refresh_token, profile, done) {","","    \tconsole.log('profile', profile);","","\t\t// asynchronous","\t\tprocess.nextTick(function() {","","\t\t\t// find the user in the database based on their facebook id","\t        User.findOne({ 'id' : profile.id }, function(err, user) {","","\t        \t// if there is an error, stop everything and return that","\t        \t// ie an error connecting to the database","\t            if (err)","\t                return done(err);","","\t\t\t\t// if the user is found, then log them in","\t            if (user) {","\t                return done(null, user); // user found, return that user","\t            } else {","\t                // if there is no user found with that facebook id, create them","\t                var newUser = new User();","","\t\t\t\t\t// set all of the facebook information in our user model","\t                newUser.id    = profile.id; // set the users facebook id\t                ","\t                newUser.access_token = access_token; // we will save the token that facebook provides to the user\t                ","\t                newUser.firstName  = profile.name.givenName;","\t                newUser.lastName = profile.name.familyName; // look at the passport user profile to see how names are returned","\t                newUser.email = profile.emails[0].value; // facebook can return multiple emails so we'll take the first","","\t\t\t\t\t// save our user to the database","\t                newUser.save(function(err) {","\t                    if (err)","\t                        throw err;","","\t                    // if successful, return the new user","\t                    return done(null, newUser);","\t                });","\t            }","","\t        });","        });","","    }));","","};"],"id":1}]]},"ace":{"folds":[],"scrolltop":69,"scrollleft":0,"selection":{"start":{"row":12,"column":13},"end":{"row":12,"column":13},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":3,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1520289825216,"hash":"8b4b93dee65f3897c10b835c09b0b8fbd98df2dd"}